<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>أيهم</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background:#f8fafc;
  height:100vh;
}
.app{
  max-width:720px;
  margin:auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.header{
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0f172a;
  color:#fff;
  font-weight:600;
}
.chat{
  flex:1;
  overflow-y:auto;
  padding:16px;
}
.msg{
  padding:14px 16px;
  border-radius:14px;
  margin-bottom:12px;
  line-height:1.7;
  font-size:15px;
}
.ai{
  background:#fff;
  border:1px solid #e5e7eb;
}
.user{
  background:#e0ecff;
}
.input-box{
  border-top:1px solid #e5e7eb;
  background:#fff;
  padding:10px;
}
.input-wrap{
  display:flex;
  gap:8px;
}
input{
  flex:1;
  padding:14px;
  border-radius:14px;
  border:1px solid #e5e7eb;
}
button{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#0f172a;
  color:#fff;
}
</style>
</head>

<body>
<div class="app">
  <div class="header">أيهم</div>
  <div id="chat" class="chat"></div>

  <div class="input-box">
    <div class="input-wrap">
      <input id="input" placeholder="اسأل أيهم…" />
      <button onclick="send()">➤</button>
    </div>
  </div>
</div>

<script src="ayhem-memory.js"></script>
<script src="ayhem-voice.js"></script>

<script>
const API = "https://autumn-brook-5828.samiaymen720.workers.dev";

function addMsg(text,type){
  const d=document.createElement("div");
  d.className="msg "+type;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  return d;
}

async function send(){
  const t=input.value.trim();
  if(!t) return;
  input.value="";
  addMsg(t,"user");

  saveMemory("user",t);

  const wait=addMsg("أيهم يفكر…","ai");

  try{
    const res=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        prompt:t,
        memory:getMemory()
      })
    });
    const data=await res.json();
    wait.textContent=data.reply;
    saveMemory("assistant",data.reply);
    speak(data.reply);
  }catch{
    wait.textContent="خطأ في الاتصال";
  }
}
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
